name: Create release

on:
  push:
    branches: [main]

permissions: read-all

jobs:
  releasepy:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest]

    steps:
      - uses: actions/checkout@v5
        with:
          fetch-depth: 0

      - name: Install uv
        uses: astral-sh/setup-uv@v6
        with:
          version: "latest"

      - name: Install .python-version
        run: |
          uv python install

      - name: Sync dependencies
        run: |
          uv sync --group commit

      - name: Configure git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Create conventional commit
        run: |
          echo "# Dummy file for release" > .dummy
          git add .dummy
          git commit -m "fix(dummy): add dummy file for testing release script"

      - name: Create release
        run: |
          uv run release.py
